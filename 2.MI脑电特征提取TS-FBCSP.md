# 2.MI脑电特征提取TS-FBCSP

| 论文名称 |Parallel genetic algorithm based common spatial patterns selection on time–frequency decomposed EEG signals for motor imagery brain-computer interface|
| -------- | -------- | 
| 期刊 |Biomedical Signal Processing and Control  5.076/Q2|
| 方法 |对脑电图信号进行了详细的时间段和频段分解(TSFBCSP)，提取了常见的空间模式特征，并提出了一种新的遗传算法(GA)编码方法进行特征选择。该方法选择最具鲁棒性和鉴别性的CSP特征，以提高脑电信号识别的准确性和鲁棒性。为了提高TSFBCSP特征选择的效率，在MapReduce框架(MRPGA)上实现了并行遗传算法。|
| 结论 |在BCI竞赛IV的两个公开数据集(2a和2b)上进行了对比实验，分类准确率分别达到了74.92%和81.04%|
| 评价 |所提出的TSFBCSP-MRPGA算法与经典的ShallowNet和EEGNet算法消耗的计算时间相当，适用于环境有限的嵌入式BCI应用。|

---

## 当前研究存在的问题
::::: row 
:::: col 研究难点
::: warning
基于电生理和血流动力学理论，**ERD的抑制广泛分布于大脑各区域**。
:::
::: warning
由于运动神经元的拓扑结构，大脑皮层采集的脑电图信号**通常由多个感觉运动神经元混合**，导致原始脑电图信号的空间分辨率较差，降低了模式识别性能
:::
::: warning
对于CSP特征求解过程中**如何选择合适的时间段和频段**，由于运动成像过程中脑电图信号的ERD抑制变化较快，目前大多数基于计算智能算法的特征选择方法都缺乏对MI-BCI分类效率的考虑。
:::

::::
:::: col 研究目标
::: tip
提高ERD抑制的空间分辨率，确保ERD抑制的有效性
:::

::::
:::::



:::danger 矛盾之处
- 如果粗糙分解将失去模式识别的一些关键特征
    - 经典滤波器通常使用[4,40]Hz的范围，将[4,40]Hz的实体频带分解为4Hz宽的频带，但这样的频段范围分解过于粗糙，会导致一些关键的ERD抑制丢失
- 如果对时域进行更细致的分解，则会产生较大的时间复杂度。
:::
:::: col 解决方法
::: tip 
为了获得最全面、最详细的空间特征，本文将EEG信号在最小单位进行时间分段和频段分解，并在分解后的时间分段和频段上提取CSP特征，称为TSFBCSP特征。
- 0.1s
- 1hz
::: warning 缺点
全面细致的分解会带来大量MI不相关的冗余特征，这会降低模式识别的性能。
:::
::: tip 如何缓解冗余？

为了缓解TSFBCSP特征对冗余特征的影响，我们引入了**遗传算法**来为特定主题选择最优特征，并确认每个会话都选择了足够和合适的空间特征。
:::
:::tip 原因
研究表明，何时开始或结束运动想象任务以及运动想象任务进行多长时间存在个体差异。获取不同运动影像主体不同阶段的实际时域过程是一项艰巨的挑战。

因此，本文的时间分段分解采用了**较长的重叠窗口**，以考虑到运动意象过程中的所有情境和阶段，包括想象准备阶段、想象阶段和想象后阶段。

然而，这种方法将为模式识别带来不相关的信息。这些冗余的特征将在后续的**特征选择过程中被剔除**。
:::
::::



## 实验数据
| 名称 | 描述 |
| -- | -- |
| BCI竞赛IV-2a数据集 | 9名受试者的4种不同MI类别(即左手、右手、脚和舌头) |
| BCI竞赛IV-2b数据集 | ... |

:::: col BCI竞赛IV-2a数据集描述
::: tip 具体实验过程
- 一开始，一个警告的哔哔声和屏幕上的一个十字被呈现给被试，以保持对焦。然后，屏幕上出现一个箭头提示，引导MI任务的类别，持续1.25s。
- 在提示出现1s后，被试根据提示的引导开始执行MI任务，每次MI任务持续4 s。在MI任务结束时，随机给受试者一段时间休息。
:::
数据集2a有两个记录会话，每个会话包含四个类别的288个标记脑电图试验。EEG记录装置包含22个电极。在模式识别实验中，使用第一阶段的288个脑电图试验进行训练，第二阶段的288个脑电图试验进行测试。
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230109152256.png#pic_center =400x)

| 名称 | 数值 |
| -- | -- |
| BCI系统 | 标准化的国际10-20电极系统 |
| EEG通道 | 22个 |
| 试验次数 | 288次 |
| 每类实验的次数 | 72次 |
| 采样频率 | 250Hz |

::::
:::: col BCI竞赛IV-2b数据集描述
::: tip 脑电极选择
数据集采集自C3、Cz和C4电极上的9名受试者，采样频率为250 Hz。
:::
每名受试者参加5次实验，最后2次作为实验数据。
::: tip 具体实验过程
- 当实验开始时，屏幕上会出现一个灰色的标签。
- 2秒时，实验装置发出短的哔哔声，提醒受试者准备开始实验。
- 从3秒到7.5秒，受试者开始根据提示想象灰色面孔的移动方向(向左或向右)。
    - 如果灰色的脸与提示的方向相同，屏幕上就会出现一张绿色的笑脸
    - 否则，就会出现一张悲伤的红脸。
- 在7.5秒时，提示消失，屏幕变成空白，然后在1到2秒的随机间隔后开始下一次测试。每次试验的拦截时间为2.5 ~ 7 s，每次试验的数据点为1125。
:::
数据集2b中有五个收集会话。前两个阶段包含120个标记脑电图试验，后三个阶段包含160个标记脑电图试验，两个class共720个标记脑电图试验。EEG记录装置包含3个电极。在模式识别实验中，前3次记录的400个脑电图被用于训练，后2次记录的320个脑电图被用于测试。。
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230117133702.png#pic_center%20=400x)
::::




## 主要工作
- 通过重叠的时间段和频段从脑电信号中提取TSFBCSP特征。基于0.1s和1Hz的分解，可以提取隐藏在非线性和非平稳脑电图信号中的MI快速变化的ERD抑制进行分类。

- 为了提高分类效率，减少MI不相关的冗余特征，引入基于并行遗传算法的MapReduce框架，选择MI相关特征，实现MI任务的快速、精确、鲁棒分类。

- 为验证所提TSFBCSP-MRPGA算法的可行性和有效性，选取9名受试者的2个公共基准MI-EEG数据集进行分类实验，在性能和效率的权衡下，所提算法显示出精确和鲁棒的结果。




![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230116205618.png#pic_center%20=400x)

### 预处理
#### 频带划分
本文在经典滤波器组的基础上，引入了重叠频带分解策略，并进行了更详细的频带分解。为了确定哪种频带划分间距是最好的，对所选数据集中的部分脑电信号进行了初步实验。

结果表明，在1 Hz和0.5 Hz的分割间隔下，分类精度几乎相同，高于常规的2 Hz或3 Hz的分割间隔。而0.5 Hz的划分在TSFBCSP特征中获得了更多的成分，增加了特征选择和分类的时间复杂度，但对分类性能的提升却微乎其微。

综合考虑，本文在[4,40]Hz中选择1 Hz的频率分解间隔，每个频段4hz的范围。
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230116173223.png#pic_center%20=400x)

#### 数据处理
- 时间段分解参数设置;
- 设置频带分解的[4,8]Hz、[5,9]Hz、…、[36,40]Hz滤波器组;
- 应用Chebyshev Type I型IIR滤波器组对输入的多元脑电图时间序列进行带通滤波;
- 从每个过滤后的多元脑电图时间序列中提取运动意象试验(4000 ms);
- 将每个运动意象试验分割为时间段，形成脑电图样本集，每个时间段共享试验标签;


### 特征提取TSFBCSP
经典的CSP算法通过优化构造空间滤波器。该优化过程确保了一个MI任务的脑电图信号方差最大，其余MI任务的脑电图信号方差最小。

|||
|-|-|
|$x^j_{i,p}\in R^{N×T}$|EED原始信号|
|$x^j_{i,p}$|代表第i个EEG时间段，第j个频带|


CSP算法计算$x^j_{i,p}\in R^{N×T}$的协方差矩阵:

$$c_{i, p}^j=\frac{x_{i, p}^j x_{i, p}^j T\quad}{\operatorname{tr}\left(x_{i, p}^j x_{i, p}^j T\right)}$$
假设两个MI任务的类别为p = 1,2
CSP算法求解以下目标函数，获得最优空间滤波器:

$$\max J\left(w_i^j\right)=\frac{w_i^{j T} c_{i, 1}^j w_i^j}{w_i^{j T}\left(c_{i, 1}^j+c_{i, 2}^j\right) w_i^j}$$
其中空间滤波器$w^j_i\in R^{N×1}$将使$c^j_{i,1}$最大化，同时使$c^j_{i,2}$最小化。上式的瑞利商形式可以转化为一般的特征值形式:

$$c_{i, 1}^j w_i^j=\lambda_i^j\left(c_{i, 1}^j+c_{i, 2}^j\right) w_i^j$$
其中λ ji和wji分别表示广义特征值和特征向量。为了最大化和最小化，对得到的特征值进行降序排序。然后，将前m个特征值对应的特征向量作为类别yp = 1的空间滤波器，同时得到类别p = 2的后m个特征值对应的特征向量作为类别p = 2的空间滤波器。这样，最终的CSP空间滤波器表示为

$$W_i^j=\left[w_{i, 1}^j, w_{i, 2}^j\right] \in R^{N \times 2 m}$$
常用的CSP特征一般采用归一化协方差形式作为最终特征
$$f_i^j=\log \left(\operatorname{diag}\left(W_i^{j T} c_i^j W_i^j / \operatorname{tr}\left(c_i^j\right)\right)\right)$$
上述计算忽略了多元脑电信号在时域上的时序关系。

因此，本文采用以下方法获得时间序列上的CSP特征:

$$f_i^j=\log \left(\left(W_i^{j T} x_i^j\right)^2\right)$$
在这次计算中，我们通过二次运算来获取多元EEG信号的功率，并通过对数运算来保证ERD抑制在一定范围内的功率变化。

---

### 特征选择GA/PGA
::: tip 基本流程
首先对大量冗余特征进行遗传编码，然后利用交叉验证分类精度构建遗传算法的适应度函数。
:::
#### 选择
采用轮盘选择法，即选择染色体的概率与适应度函数的值成正比。假设TSFBCSP特征编码的染色体种群大小为g，单染色体的适应度函数为$f(x_i)$，xi染色体被选中的概率可计算为

$$P\left(x_i\right)=\frac{f\left(x_i\right)}{\sum_{j=1}^g f\left(x_j\right)}$$
- 分子是个体染色体的适合度值
- 分母是所有染色体的适合度值之和。

使用轮盘选择方法可以保证适应度值较高的染色体在下一代中保留的概率更大，而适应度值较小的染色体很容易被淘汰。可以选择在特定会话中适合特定主题的染色体。

#### 交叉
根据交叉概率$p_c$，两条相互配对的染色体将交换部分染色体，基因以一定的方式形成两条新的染色体。在交叉过程中，采用随机配对配对策略进行交叉操作，限制条件为确保子代数量在2⩽g⩽k范围内，其中k为恒定阈值。

#### 突变
假设编码染色体的维数为s，在指定的突变概率$p_m$内随机生成一个随机整数。利用生成的整数获得新编号的基因，构造一些新的染色体来取代突变前的染色体，形成新的群体。群体中发生突变的个体可以保持群体的多样性，也可以防止早熟的发生。同样，在迭代中执行相同的判断标准，以防止新生成的染色体与父染色体相同。


### 训练
在实际的对比实验中，将两个数据集的训练集分解为十个相等的部分，并使用留一法交叉验证在训练集上训练一个SVM模型。然后将训练好的SVM模型纳入测试集，得到平均分类精度，利用平均分类精度来评价GA/MRPGA的适合度。

在实验过程中，由于计算资源的限制，我们将多变量脑电图信号的采样率降低到125 Hz。
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230116210352.png#pic_center%20=400x)
|||
|-|=|
|数据集2a的SVM参数|γ = 1|
|数据集2b的SVM参数|γ = 0.01|
|GA/MRPGA默认参数|染色体数g = 30，每条染色体维数20，交叉概率Pc = 95\%，突变概率Pm = 5%|

## 结果
### 特征提取效果-SVM平面
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230116211302.png#pic_center%20=400x)


### 精度比较

表中“proposal”表示TSFBCSP-GA，“proposal - mr”表示TSFBCSP-MRPGA，表中“SD”表示各被试间的标准差。
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230116210614.png#pic_center%20=400x)

![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230116210632.png#pic_center%20=400x)
### 计算成本比较
所提出的TSFBCSP-MRPGA算法与经典的ShallowNet和EEGNet算法消耗的计算时间相当，适用于环境有限的嵌入式BCI应用。
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230116210828.png#pic_center%20=400x)




### 并行GA的消融实验
经典遗传算法(蓝色方格)和MRPGA(橙色方格)选取的有效TSFBCSP特征基本相同。这些对比结果证明了并行遗传算法是有效的，同时，通过并行处理，大大提高了特征选择的效率。
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230116210930.png#pic_center%20=400x)