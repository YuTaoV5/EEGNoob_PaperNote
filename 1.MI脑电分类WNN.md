# 1.MI脑电分类WNN

| 论文名称 |Single upper limb functional movements decoding from motor imagery EEG signals using wavelet neural network |
| -------- | -------- | 
| 期刊 |Biomedical Signal Processing and Control  5.076/Q2|
| 方法 |在这项研究中，我们提出了一种小波神经网络(WNN)来提高运动图像(MI)脑电图信号的运动解码性能。15名健康受试者进行单上肢6种功能性运动:前臂旋前/旋后、手开合、肘关节屈伸。采用小波包分解(WPD)将脑电信号分解为子带，从子带中提取统计特征，对脑电信号进行功能运动编码。然后，采用主成分分析(PCA)选择最佳特征向量。通过实验对母小波、多维小波函数、通道数、成像分段时间等因素进行了优化。|
| 结论 |结果表明，优化后的六级分解coif1母小波，以`Mexican Hat小波函数`为超参数，成像段时间设置为0.7 s, 61通道数据，精度最高，为86.27±6.98%。此外，为了进一步验证小波神经网络分类器的有效性，分别与支持向量机(SVM)、线性判别分析(LDA)、k-最近邻(KNN)和单隐层前馈神经网络(ANN)进行了对比实验。结果表明，小波神经网络的准确率提高了约15 ~ 40%，证明了小波神经网络方法的有效性。|
| 评价 |与LDA、SVM、ANN和KNN相比，小波神经网络的准确率提高了15 ~ 40%，证明了该方法的有效性。|

---

## 实验数据
本研究使用了来自`BNCI Horizon 2020`的公共脑电图数据集。
该数据集来自15名年龄在22岁至40岁之间的健康受试者，平均年龄为27岁。
在范例中，实验中的六种功能运动类型包括：
- 前臂旋前
- 前臂旋后
- 手开
- 手合
- 肘关节屈
- 肘关节伸
### 实验流程
本研究仅使用每个受试者数据集的前两次连续训练，他们分别完成了6类不同的上肢功能动作，共72次。这种模式是基于试验的，线索显示在受试者面前的电脑屏幕上。该范例如图所示。
|||
| -- | -- |
|第0秒|一个十字出现在电脑屏幕上并发出哔哔声。|
|第2秒|电脑屏幕上出现一个提示，指示所需的移动。|
|第5秒|在试验结束时，受试者回到开始的位置。|

![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230116212506.png#pic_center%20=400x)

### 数据采集与预处理
|||
|-|-|
|数据集采样频率|512 Hz|
|滤波频率|0.01 Hz~200 Hz|
|通道数量|61个通道信号|
|基电极|AFz|

- 用50Hz的带通滤波器抑制了电力线干扰。
- 使用EEGLAB从原始数据中去除不相关的通道，并使用通道光谱图插值坏电极。
- 进行独立成分分析(ICA)以识别代表眼球运动和肌肉伪影的成分。
- 然后用带通滤波在8到30 Hz之间进行滤波。有研究表明，运动想象的持续时间不能超过0.5s。

因此，将滤波后的信号分割为0.5s的连续成像周期段，对相应的运动进行编码，使用MNE实现。
分割后，将数据集随机分为训练集和测试集。训练集用于选择最佳特征并训练分类器模型，而测试集用于评估分类。






## 主要工作
本文提出了一种用于单上肢六类功能运动解码的小波神经网络模型。
- 在信号处理中，我们优化了特征向量的构造方法。
- 然后，小波神经网络参数、脑电通道数和成像段时间分别影响解码性能，并在实验方法中对其进行了优化。
- 通过与单隐层前馈神经网络(ANN)、支持向量机(SVM)、LDA和KNN的对比实验，评价了所提小波神经网络分类器的分类效率。
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230116212455.png#pic_center%20=400x)

---
### 特征提取
:::: col
::: tip 输入
EEG epoch。
:::
::: tip 输出
特征向量。
:::
::: tip 流程
1. 输入脑电图的epoch、母小波名称、max-level分解。

2. 计算WPD的平均值、标准差、范围、中位数、均方根、偏度、峰度和子带比。

3. 将特征进行标准化。

4. 计算特征的协方差矩阵。

5. 返回特征向量。
:::
::::
#### WPD过程
:::: col 
::: tip 原因

本研究采用的小波分解(WPD)对信号进行了多层次的时频分解，具有良好的时频局部化特性。它克服了傅里叶变换在时域内没有局部化的缺点，在生物医学信号分析中得到了广泛的应用。
::: 
::: tip 特征选取

从WPD的每个频段提取统计特征是最常用和最简单的计算特征向量的方法。本文选取了均值、标准差、极差、中位数、均方根、偏度、峰度和子带比。
:::
对信号进行n层分解将产生2n个小波系数，小波分解的算法原理表达式为
$$S_{\xi, \eta, 2 f}=\frac{1}{\sqrt{2}} \sum_k h_{k-2 \eta} S_{\xi+1, k, f}$$
$$S_{\xi, \eta, 2 f+1}=\frac{1}{\sqrt{2}} \sum_k g_{k-2 \eta} S_{\xi+1, k, f}$$

|||
|-|-|
|$S_{\xi, \eta, 2 f}$和$S_{\xi, \eta, 2 f+1}$|下一层小波分解的结果|
|$S_{\xi+1, k, f}$|是上层分解的结果|
|$\xi$|比例系数|
|$\eta$|位置系数|
|$f$|采样频率|
|$g$|低通滤波器|
|$h$|高通滤波器|
::::
### 特征标准化
数据集标准化和使用主成分分析(PCA)来降维是各种机器学习算法的一个众所周知的要求。PCA将样本数据映射到特征矩阵的主成分空间，以保留大部分数据差异，并且具有较低的维数。主成分向量彼此正交，所以它们的方差最大。主成分Pk由n维原始数据X组合而成，其表达式如下:
$$P_k=a_{k 1} x_1+a_{k 2} x_2+\cdots+a_n x_{k n}, \sum_i a_{k i}^2=1$$


### 小波神经网络
::: tip 基本思想
将小波基适应训练数据，在输入层将变量引入神经网络，在隐层将输入变量转换为母小波的展开和平移，最后在输出层估计出目标值的近似值。
:::


在本研究中，我们将多维小波函数$\phi_j(x)$作为隐层的超参数，然后将激活函数用于输出层。隐藏层只是在输入层和输出层之间添加更多的神经元，输出层中的神经元依赖于分类的数量。

输出值Y的计算定义为
$$Y_{[i=1,2,3 \ldots]}=g_\lambda(x, w)=w_{N+1}+\sum_{j=1}^\lambda w_j \cdot \varphi_j(x)+\sum_{k=1}^m w_k \cdot x_k$$

|||
|-|-|
|$X_m$|输入层中的数据|
|$N = 2m +α， α\in(0,9)$|隐层神经元数量,由经验公式确定|
|$\phi_j(x)$|多维小波函数|
|$w_k$|直接连接|
|$w_j$|网络权值|
|$w_{\zeta(ij)}$|平移因子|
|$w_{\xi(ij)}$|扩张因子|

#### 参数初始化
小波神经网络不适合像sigmoid神经网络那样将初始值初始化为随机值，因为平移因子和扩张因子的初始化对神经网络的性能有重要影响。目前已经提出了各种初始化方法:
$$w_{(\xi) i j}=0.5\left(N_i+M_i\right)$$
$$w_{(\zeta) i j}=0.2\left(M_i-N_i\right)$$
其中$M_i$和$N_i$定义为输入$X_m$的最大值和最小值。
#### 权重更新
小波神经网络算法起源于前馈神经网络，使用了反向传播的基本思想，即找出每个权重对误差的贡献百分比。$E$的定义和更新执行如下
$$E=\sum \frac{\left(y_t-y_p\right)^2}{2}$$
$$w_k=w_k-l \frac{\partial E}{\partial w_k}$$
$$w_j=w_j-l \frac{\partial E}{\partial w_j}$$
$$w_{(\xi) i j}=w_{(\xi) i j}-l \frac{\partial E}{\partial w_{(\xi) i j}}$$
$$w_{(\xi) i j}=w_{(\xi) i j}-l \frac{\partial E}{\partial w_{(\xi) i j}}$$

|||
|-|-|
|$y_t$|最终输出|
|$y_p$|是期望输出|
|$l$|是学习率|
|$dropout$参数|设置为$10^{−8}$|

#### 小结
:::: col
::: tip 输入
一组脑电图训练数据Xm，隐藏节点数和分类数。
:::
::: tip 输出
预测标签。
:::
::: tip 流程
1. 随机初始化权向量直接连接权值、网络权值。根据公式初始化平移因子和扩张因子
2. 计算多维小波
3. 使用多维小波计算隐藏层输出
4. 使用激活函数计算输出
5. 计算误差E
6. 更新参数
7. 如果参数条件< $10^{-8}$，停止并返回预测标签。否则，返回步骤3。

:::
::::

### 训练与部署
结果记录和评估使用10倍交叉验证。
使用`精度`、`kappa值`来评估所提方法在六分类任务的运动分类中的分类性能。

采用配对t检验对不同方法的性能参数进行统计学比较，显著性水平设置为P = 0.05
#### 硬件
- 1.6 GHz CPU
- 8 GB RAM的PC





### 小波基的选择
在特征提取阶段，利用WPD对MI脑电图信号进行分解，从每个频段提取统计特征。然而，不同的母小波函数具有不同的时频特性。为了探究不同母小波的时频特性对结果的影响，我们分别实验了8个不同的母小波函数
- db2
- db4
- sym5
- sym7
- coif1
- coif3
- bior2.4
- bior3.7


![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230117011204.png#pic_center%20=400x)
实验结果表明，**coif1母小波**用于六级分解提取特征的WPD分类效果优于其他母小波。coif1母小波的平均分类准确率最高

![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230117011214.png#pic_center%20=400x)


### 激活函数
激活函数对神经网络有重要影响，WPD中使用的不同母小波对分类性能也有重要影响。小波神经网络的母小波激活函数可以是任意多维小波函数。但在文献中，常用的有三种，
- Morlet
- Mexican Hat
- Gaussian derivative

超参数函数及其导数如图所示
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230117011232.png#pic_center%20=400x)
与其他激活函数相比，**Mexican Hat**在分类性能上与sigmoid、Morlet、POLYWOG3有显著差异(p值< 0.05)，因此，我们选择`Mexican Hat小波函数`作为小波神经网络分类器的最佳超参数函数。
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230117011808.png#pic_center%20=400x)


### 成像时间
当成像段时间设置为0.1 s时，信号数量明显减少，这可能是信号质量较差的原因。

当成像段时间设置为1.0 s时，平均准确率也会显著降低(p值< 0.05)。因此，我们选择**0.7s**作为MI脑电图解码的成像段时间，获得了较好的解码精度。
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230117012505.png#pic_center%20=400x)

### 通道选择
在这项研究中，受试者执行了单个上肢的6个功能性动作。在以往的实验中，采用`coif1母小波`进行六级分解，以`Mexican Hat小波函数`为超参数，将成像段的时间设置为`0.7s`，选取61个通道数据，取得了最佳的准确率86.27±6.98%。当仅使用FCz、C3、Cz、C4和CPz 5个通道时，其准确度为36.95±11.31%。当使用41个通道的脑电图数据时，准确率达到84.98±7.69%。实验结果表明，33%的信道(61减少到41)减少只导致约2%的精度下降，但计算时间减少了20 s。

适当的通道数量可以提高分类效率。
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230117012343.png#pic_center%20=400x)


### 模型比较
与LDA、SVM、ANN和KNN相比，小波神经网络的准确率提高了15 ~ 40%，证明了该方法的有效性。
![Img](https://imgpool.protodrive.xyz/img/yank-note-picgo-img-20230117011833.png#pic_center%20=400x)









